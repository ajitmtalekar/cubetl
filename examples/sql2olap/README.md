# Create and serve an OLAP schema from an existing DB using Cubes

CubETL provides some entry points for inspecting an existing SQL database,
generating an OLAP model, and exporting a Cubes configuration.

All together, this can be used to quickly inspect an existing database using CubesViewer.

## Downloading the Chinook database

This example uses the well-known *Chinook test database*. It is provided for many
database systems.

We will use the SQLite version. Grab a copy of the database and place it in this directory
(here we use wget to download the file):

	wget https://github.com/lerocha/chinook-database/raw/master/ChinookDatabase/DataSources/Chinook_Sqlite.sqlite

Make sure the file is correct by running `file Chinook_Sqlite.sqlite':

    $ file Chinook_Sqlite.sqlite
    Chinook_Sqlite.sqlite: SQLite 3.x database

## Running the process

Let's run the an initial, default import process:

    # Inspect database and generate a cubes model and config
    cubetl cubetl.sql.db2sql cubetl.olap.sql2olap cubetl.cubes.olap2cubes \
        -p db2sql.db_url=sqlite:///mydb.sqlite3 \
        -p olap2cubes.cubes_model=mydb.cubes-model.json \
        -p olap2cubes.cubes_config=mydb.cubes-config.ini

This runs three process nodes sequentially:

* **cubetl.sql.db2sql**: This connects to the target database and imports the SQL schema
  into CubETL model (using `cubetl.sql.SQLTable` and `cubetl.sql.SQLColumn`).
* **cubetl.olap.sql2olap**: This walks the cubetl.sql.SQLTable objects in the context
  and generates `cubetl.olap.*` entities for the SQL schema.
* **cubetl.cubes.olap2cubes**: This processes the OLAP schema defined in the previous step
  and generates a *Cubes OLAP Server* model and configuration file.

Also note that parameters are passed using `-p property=value`.

## Visualizing the dataset

Now you can serve the mapped database using Cubes, and browse it using CubesViewer.

For this example you need to have Cubes Server and CubesViewer packages installed.

    # Run cubes server (in background with &, or in another terminal)
    pip install cubes
    slicer serve mydb.cubes-config.ini &

    # Run a local cubesviewer HTTP server (also opens a browser)
    pip install cubesviewer-utils
    cvutils cv

## Options

The *sql2olap* utility generates an OLAP schema using simple guessing. Numbers are
considered observations and strings are always considered dimensions, even if they are
details.

Often, we want to control this process. The SQLToOLAP class accepts several options
that can be used to fine-tune how the schema generator works.

**Changing how fields are imported**

If you observe the generated schema you'll notice some columns would be more appropriate
if treated differently. For example,

*Note*: you need to restart your Cubes server and your CubesViewer instance to
account for the new schema changes!

**Complete command**



**Use a shell script for this**

When running this from command line, it is recommended to create a shell script
that runs it. That way you can keep track of the additional settings for the schema importers,
as they can become quite lengthy. This directory includes the `sql2olap.sh` shell script,
which is the final example of this. You can run it using:

    bash sql2olap.sh


## Tips

This process is designed for quick inspection of existing databases.

Beyond this, you'd normally wish to define your own model or to further extend
the one that was automatically generated by CubETL. For this, defining your own
CubETL config works best, this way you have then greater flexibility for
configuring your model and processes.

